function getConfig(){return{apiKey:"ECLJI0GPBJVEXSZDT",spotifySpace:"spotify",echoNestHost:"http://developer.echonest.com/"}}function getSpotifyPlayButtonForPlaylist(t,n){var s='<iframe src="https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:TRACKS" style="width:640px; height:520px;" frameborder="0" allowtransparency="true"></iframe>',o=[];n.forEach(function(t){var n=fidToSpid(t.tracks[0].foreign_id);o.push(n)});var a=o.join(","),i=s.replace("TRACKS",a);i=i.replace("PREFEREDTITLE",t);$("<span>").html(i);return $("<span>").html(i)}function fidToSpid(t){var n=t.split(":");return n[n.length-1]}function getSpotifyPlayer(t,n){function s(){var s=[];t.forEach(function(t){var n=fidToSpid(t.tracks[0].foreign_id);s.push(n)}),$.getJSON("https://api.spotify.com/v1/tracks/",{ids:s.join(",")}).done(function(a){console.log("sptracks",s,a),a.tracks.forEach(function(n,s){t[s].spotifyTrackInfo=n}),console.log("inPlaylist",t),g=o(t),songs=[];for(var r=0;r<g.length;r++){var l={};l.album=g[r].spotifyTrackInfo.album.name,l.artist=g[r].artist_name,l.name=g[r].title,l.art=i(g[r].spotifyTrackInfo.album.images,900),l["spotify-link"]=g[r].spotifyTrackInfo.external_urls.spotify,songs.push(l)}e(!1),n(d)}).error(function(){info("Whoops, had some trouble getting that playlist")}),$("#m-artist").html($("#artist").val()),console.log(g)}function o(t){function n(t){return null!=t.spotifyTrackInfo.preview_url}var s=[];return t.forEach(function(t){n(t)&&s.push(t)}),s}function a(t,n){$(d).find(".sp-album-art").attr("src",i(t.spotifyTrackInfo.album.images,300).url),$(d).find(".sp-title").text(t.title),$(d).find(".sp-artist").text(t.artist_name),u.attr("src",t.spotifyTrackInfo.preview_url),$("#songs").html("");for(var s=0;20>s;s++){var o="";console.log(s),"art"in songs[s]?"url"in songs[s].art?(o+="<div class='song'><img class='cover-art' src='"+songs[s].art.url+"'/><div class='desc'><h1>"+songs[s].name+"</h1><h2>"+songs[s].artist+" - "+songs[s].album+"</h2>",o+="<a href='"+songs[s]["spotify-link"]+"'>View on Spotify</a></div></div>"):(o+="<div class='song'><img class='cover-art' src='assets/default.jpg'/><div class='desc'><h1>"+songs[s].name+"</h1><h2>"+songs[s].artist+" - "+songs[s].album+"</h2>",o+="<a href='"+songs[s]["spotify-link"]+"'>View on Spotify</a></div></div>"):(o+="<div class='song'><img class='cover-art' src='assets/default.jpg'/><div class='desc'><h1>"+songs[s].name+"</h1><h2>"+songs[s].artist+" - "+songs[s].album+"</h2>",o+="<a href='"+songs[s]["spotify-link"]+"'>View on Spotify</a></div></div>"),$("#songs").append(o)}n&&u.get(0).play()}function i(t,n){var s=t[0];return t.reverse().forEach(function(t){t.width<=n&&(s=t)}),s}function e(t){a(g[p],t)}function r(){21>p&&(p++,e(!0))}function l(){p>0&&(p--,e(!0))}function c(){console.log("tpp",u.get(0).paused),u.get(0).paused?u.get(0).play():u.get(0).pause()}function f(){var t=$("<div class='sp-player'>"),n=$("<img class='sp-album-art'>"),s=$("<div class='sp-info'>"),o=$("<div class='sp-title'>"),a=$("<div class='sp-artist'>"),i=$("<div class='btn-group sp-controls'>"),e=$('<button class="btn btn-primary btn-sm" type="button"><i class="fa fa-step-forward"></button>'),f=$('<button class="btn btn-primary btn-sm" type="button"><i class="fa fa-step-backward"></span></button>'),p=$('<button class="btn btn-primary btn-sm" type="button"><i class="fa fa-play"></span></button>');return u=$("<audio>"),u.on("pause",function(){var t=p.find("i");t.removeClass("fa-pause"),t.addClass("fa-play")}),u.on("play",function(){var t=p.find("i");t.addClass("fa-pause"),t.removeClass("fa-play")}),u.on("ended",function(){console.log("ended"),r()}),e.on("click",function(){r()}),p.on("click",function(){c()}),f.on("click",function(){l()}),s.append(o),s.append(a),i.append(f),i.append(p),i.append(e),t.append(n),t.append(s),t.append(i),t.bind("destroyed",function(){console.log("player destroyed"),u.pause()}),t}var p=0,u=null,d=f(),g=null;return s(),d}function fetchArtistPlaylist(t){var n=config.echoNestHost+"api/v4/playlist/static";$("#all_results").empty(),info("Creating the playlist ..."),$.getJSON(n,{artist:t,api_key:config.apiKey,bucket:["id:"+config.spotifySpace,"tracks"],song_selection:"energy-bottom",sort:"energy-asc",limit:!0,variety:1,results:40,type:"artist-radio"}).done(function(t){if(info(""),"songs"in t.response){getSpotifyPlayer(t.response.songs,function(t){console.log("got the player"),$("#all_results").append(t)})}else info("Can't find that artist")}).error(function(){info("Whoops, had some trouble getting that playlist")})}function newArtist(){var t=$("#artist").val();fetchArtistPlaylist(t,!1,.2)}function info(t){$("#info-song").text(t)}function initUI(){$("#artist").on("keydown",function(t){13==t.keyCode&&newArtist()}),$("#go").on("click",function(){newArtist()})}var songs=[];!function(t){t.event.special.destroyed={remove:function(t){t.handler&&t.handler()}}}(jQuery),jQuery.ajaxSettings.traditional=!0;var config=getConfig();$(document).ready(function(){initUI(),newArtist()});